{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"location": {
			"type": "string",
			"minLength": 1,
			"metadata": {
				"description": "Datacenter Region Location"
			}
		},
		"sshKeyPath": {
			"type": "string",
			"minLength": 1,
			"metadata": {
				"description": "SSH Public Key Path"
			}
		},
		"sshPublicKey": {
			"type": "string",
			"minLength": 1,
			"metadata": {
				"description": "SSH Public Key"
			}
		},
		"adminUsername": {
			"type": "string",
			"minLength": 1,
			"metadata": {
				"description": "Admin Username"
			}
		},
		"vmSize": {
			"type": "string",
			"minLength": 1,
			"metadata": {
				"description": "VM Size"
			}
		},
		"hostname": {
			"type": "string",
			"minLength": 1,
			"metadata": {
				"description": "VM Hostname"
			}
		},
		"customImageName": {
			"type": "string",
			"minLength": 1,
			"metadata": {
				"description": "Name of Custom VHD Image"
			}
		},
		"newStorageAccount": {
			"type": "string",
			"minLength": 1,
			"metadata": {
				"description": "Storage Account"
			}
		},
		"customStorageAccount": {
			"type": "string",
			"minLength": 1,
			"metadata": {
				"description": "Storage Account for Custom Image"
			}
		},
		"apiVersionStorage": {
			"type": "string",
			"minLength": 1,
			"metadata": {
				"description": "Storage API Version"
			}
		},
		"apiVersionCompute": {
			"type": "string",
			"minLength": 1,
			"metadata": {
				"description": "Compute API Version"
			}
		}
	},
	"variables": {
	},
	"resources": [{
		"type": "Microsoft.Compute/virtualMachines",
		"name": "[parameters('hostname')]",
		"location": "[parameters('location')]",
		"apiVersion": "[parameters('apiVersionCompute')]",
		"tags": {
			"displayName": "[concat(parameters('hostname'), ' VM Creation')]"
		},
		"properties": {
			"hardwareProfile": {
				"vmSize": "[parameters('vmSize')]"
			},
			"osProfile": {
				"computerName": "[parameters('hostname')]",
				"adminUsername": "[parameters('adminUsername')]",
				"linuxConfiguration": {
					"disablePasswordAuthentication": true,
					"ssh": {
						"publicKeys": [{
							"path": "[parameters('sshKeyPath')]",
							"keyData": "[parameters('sshPublicKey')]"
						}]
					}
				}
			},
			"storageProfile": {
				"osDisk": {
					"name": "[concat(parameters('hostname'), 'osdisk')]",
					"image": {
						"uri": "[parameters('customImageName')]"
					},
					"vhd": {
						"uri": "[concat(parameters('customStorageAccount'), 'vhds/', parameters('hostname'), '.vhd')]"
					},
					"osType": "Linux",
					"caching": "ReadWrite",
					"createOption": "FromImage"
				}
			},
			"networkProfile": {
				"networkInterfaces": [{
					"id": "[resourceId('Microsoft.Network/networkInterfaces', concat(parameters('hostname'), '-nic'))]"
				}]
			}
		}
	}],
	"outputs": {}
}